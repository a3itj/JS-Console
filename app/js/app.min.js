$(function(){"use strict";function getSuggestion(){matchedIndex=null,typedVal=command.val(),matched=patternMatch(typedVal)}function setValue(a){currentHistory=a||"",command.focus(),command.val(currentHistory),output.scrollTop(output[0].scrollHeight-output.height())}function autoComplete(){matched.length>0&&(matchedIndex?matchedIndex+=1:matchedIndex=1,matchedIndex===matched.length+1?(matchedIndex=null,command.val(typedVal)):command.val(matched[matchedIndex-1]))}function getProps(a){var b=[];try{for(var c in a)b.push(c)}catch(d){}return b}function patternMatch(pattern){var prop="window",psplit=pattern.split("."),plength=psplit.length,pt=pattern;plength>1&&(prop=psplit.slice(0,plength-1).join("."),pt=psplit[plength-1]);var props=getProps(eval(prop));return props.filter(function(a){return 0===a.indexOf(pt)}).map(function(a){return plength>1?prop+"."+a:a})}function loadScript(a){var b=document.createElement("script");b.type="text/javascript",b.src=a,document.body.appendChild(b)}function showHistory(){var a,b=localStorage.getItem("cmdHistory").split(","),c=document.createDocumentFragment();b.forEach(function(b,d){a=document.createElement("div"),a.innerHTML=b.trim(),a.className="history",c.appendChild(a)}),output.append(c)}function moveThroughHistory(a){var b=localStorage.getItem("cmdHistory").split(","),c=b.length;currentIndex=currentIndex||c,0>a&&0!==currentIndex?currentIndex-=1:a>0&&currentIndex!==c&&(currentIndex+=1),setValue(b[currentIndex])}function execCommand(a){if(a)switch(currentIndex=null,cmdHtml(a),a){case":history":showHistory();break;case":help":showHelp();break;case":clear":clear();break;case":removehistory":removehistory();break;default:evalCommand(a)}}function showHelp(){var a=$("#help");output.after(a)}function cmdHtml(a){var a=$('<pre class="cmd"></pre>').html(a);output.append(a)}function stringify(a){try{return JSON.stringify(a)}catch(b){return a.toString()}}function toEscaped(a){return String(a).replace(/\\"/g,'"').replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function evalCommand(a){var b=$('<div class="response"></div>');try{var c=eval.call(window,a)}catch(d){c=d.toString(),b.addClass("error")}_.isString(c)&&(c='"'+c.toString().replace(/"/g,'\\"')+'"'),_.isFunction(c)&&(c=c.toString().replace(/"/g,'\\"')),_.isObject(c)&&(c=stringify(c).replace(/"/g,'\\"')),_.isUndefined(c)&&(c="undefined"),b.html(toEscaped(c)),$("#output").append(b)}function clear(){$("#output").html("")}function addHistory(a){var b=localStorage.getItem("cmdHistory")||"";try{localStorage.setItem("cmdHistory",b+","+command.val()),command.val("")}catch(c){alert("Exceeded Storage Quota!")}}var command=$("#cmdInput"),output=$("#output"),currentHistory="",currentIndex=null,matchedIndex=null,matched=[],typedVal="",content=$("#content");command.on("keyup",function(a){var b=a.keyCode,c=command.val().trim();if(c)switch(b){case 13:execCommand(c),addHistory(),setValue();break;case 9:autoComplete();break;default:getSuggestion()}}),command.on("keydown",function(a){var b=a.keyCode;9===b&&a.preventDefault(),(38===b||40===b)&&moveThroughHistory(b-39)}),function(){localStorage.setItem("cmdHistory","")}()});